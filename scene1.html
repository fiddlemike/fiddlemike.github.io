<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Michael Machado - Visualizations</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v0.3.min.js"></script>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="css/custom.css">
  <link rel="stylesheet" href="css/barchart.css">

</head>

<body class="container">
  <header id="header">
    <nav class="navbar navbar-default" role="navigation">
      <div class="container-fluid">

        <div class="navbar-header">
          <a class="navbar-brand" href="https://d3js.org/" target="_blank">
                <span class="glyphicon glyphicon glyphicon-tree-deciduous"></span>
                D3 is fun
            </a>

          <ul class="nav navbar-nav">
            <li><a href="/">Home</a></li>
            <li><a href="/scene1">Scene 1</a></li>
            <li><a href="/essay">Essay</a></li>
          </ul>
        </div>

      </div>
    </nav>
  </header>
  <div id="drop" class="toolbar" align="center">
  </div>
  <main>
    <div id="viz" class="barchart">
      <script>
        // register events to emit & listen for via d3 dispatch
        var dispatch = d3.dispatch("load", "statechange");
        // the first year of our dataset we want the chart to load with
        var defaultYear = "2013";
        // Set the data value to use for color
        var colorColumn = "state";
        // Add the tooltip
        var tooltip = d3.select("body").append("div").attr("class", "toolTip");
        // Add a label for the drop down
        d3.select("#drop").append("label").text("Incident Year: ");

        // load our data! When done call our dispatch events with corresponding data
        d3.csv("data/incidents_by_year_and_state.csv", function(d) {
          return {
            year: d.year,
            state: d.state,
            freq: +d.freq // // coerce values forfrequency to be numeric
          };
        }, function(error, csv_data) {
          if (error) throw error;
          // construct a new d3 map, not as in geographic map,
          // but more like a "hash"
          var map = d3.map(csv_data, function(d) {
            return d.year;
          });

          // call our dispatch events with `this` context, and corresponding data
          dispatch.call("load", this, map);
          dispatch.call("statechange", this, map.get(defaultYear));
        });

        // A drop-down menu for selecting a state; uses the "menu" namespace.
        // register a listener for "load" and create a dropdown / select element
        dispatch.on("load.menu", function(map) {
          // create select dropdown, attach a native DOM event listener "change"
          // that will invoke dispatch.call with a "statechange" event
          var select = d3.select("#drop")
            .append("select")
            .on("change", function() {
              var site = this.value;
              dispatch.call(
                "statechange",
                this,
                map.get(site)
              );
            });

          // append options to select dropdown
          select.selectAll("option")
            .data(map.keys().sort())
            .enter().append("option")
            .attr("value", function(d) {
              return d;
            })
            .text(function(d) {
              return d;
            });

          // set the current dropdown option to the value of the last statechange
          dispatch.on("statechange.menu", function(site) {
            select.property("value", site.key);
          });
        });
      </script>
    </div>

  </main>

  <footer id="footer">
    <hr>
    <p class="text-center text-muted">Â© Copyright 2018 Michael Machado</p>
  </footer>


</body>

</html>
