<!DOCTYPE html>
<html lang="en">
<script>
  function handleLoad(e) {
    console.log('Loaded import: ' + e.target.href);
  }

  function handleError(e) {
    console.log('Error loading import: ' + e.target.href);
  }
</script>

<head>
  <link rel="import" href="./templates/head.html" id="head" onload="handleLoad(event)" onerror="handleError(event)">
  <link rel="import" href="./templates/footer.html" id="std-footer" onload="handleLoad(event)" onerror="handleError(event)">
  <link rel="import" href="./templates/header.html" id="std-header" onload="handleLoad(event)" onerror="handleError(event)">
  <link rel="stylesheet" href="css/scatterplot.css">
</head>

<body class="container">
  <header id="header">
    <script>
      // Get the link element that references the header.html file.
      var headerTemplate = document.getElementById('std-header');
      // Retrieve the loaded templates.
      var templates = headerTemplate.import
      // Get the template.
      var template = templates.getElementById('std-header');
      if (template) {
        // Clone the templates contents
        var clone = document.importNode(template.content, true);
        // Add the template code to the page header
        document.getElementById('header').appendChild(clone);
      } else {
        console.log('unable to access template.');
      }
    </script>
  </header>

  <main>
    <div class="sidebar-sticky sidebar">
      <a href="/essay" target="_blank" class="btn btn-primary btn-lg active" role="button" aria-pressed="true">Essay</a>
      <p>Test of side bar</P>
    </div>

    <div id="svg-chart" style="width:75%">

      <script>
        var margin = {
            top: 20,
            right: 20,
            bottom: 30,
            left: 40
          },
          width = 960 - margin.left - margin.right,
          height = 500 - margin.top - margin.bottom;

        /*
         * value accessor - returns the value to encode for a given data object.
         * scale - maps value to a visual display encoding, such as a pixel position.
         * map function - maps from data value to display value
         * axis - sets up axis
         */

        // setup x
        var xValue = function(d) {
            return d.Calories;
          }, // data -> value
          xScale = d3.scaleLinear().range([0, width]), // value -> display
          xMap = function(d) {
            return xScale(xValue(d));
          }, // data -> display
          xAxis = d3.axisBottom(xScale).tickFormat(function(d){ return d.x;});

        // setup y
        var yValue = function(d) {
            return d["Protein (g)"];
          }, // data -> value
          yScale = d3.scaleLinear().range([height, 0]), // value -> display
          yMap = function(d) {
            return yScale(yValue(d));
          }, // data -> display
          yAxis = d3.axisLeft(yScale);

        // setup fill color
        var cValue = function(d) {
            return d.Manufacturer;
          },
          color = d3.scaleOrdinal(d3.schemeCategory10);

        // add the graph canvas to the body of the webpage
        var svg = d3.select("svg-chart").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // add the tooltip area to the webpage
        var tooltip = d3.select("body").append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

        // load data
        d3.csv("./data/cereal.csv", function(error, data) {

          // change string (from CSV) into number format
          data.forEach(function(d) {
            d.Calories = +d.Calories;
            d["Protein (g)"] = +d["Protein (g)"];
            //    console.log(d);
          });

          // don't want dots overlapping axis, so add in buffer to data domain
          xScale.domain([d3.min(data, xValue) - 1, d3.max(data, xValue) + 1]);
          yScale.domain([d3.min(data, yValue) - 1, d3.max(data, yValue) + 1]);

          // x-axis
          svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis)
            .append("text")
            .attr("class", "label")
            .attr("x", width)
            .attr("y", -6)
            .style("text-anchor", "end")
            .text("Calories");

          // y-axis
          svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
            .attr("class", "label")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Protein (g)");

          // draw dots
          svg.selectAll(".dot")
            .data(data)
            .enter().append("circle")
            .attr("class", "dot")
            .attr("r", 3.5)
            .attr("cx", xMap)
            .attr("cy", yMap)
            .style("fill", function(d) {
              return color(cValue(d));
            })
            .on("mouseover", function(d) {
              tooltip.transition()
                .duration(200)
                .style("opacity", .9);
              tooltip.html(d["Cereal Name"] + "<br/> (" + xValue(d) +
                  ", " + yValue(d) + ")")
                .style("left", (d3.event.pageX + 5) + "px")
                .style("top", (d3.event.pageY - 28) + "px");
            })
            .on("mouseout", function(d) {
              tooltip.transition()
                .duration(500)
                .style("opacity", 0);
            });

          // draw legend
          var legend = svg.selectAll(".legend")
            .data(color.domain())
            .enter().append("g")
            .attr("class", "legend")
            .attr("transform", function(d, i) {
              return "translate(0," + i * 20 + ")";
            });

          // draw legend colored rectangles
          legend.append("rect")
            .attr("x", width - 18)
            .attr("width", 18)
            .attr("height", 18)
            .style("fill", color);

          // draw legend text
          legend.append("text")
            .attr("x", width - 24)
            .attr("y", 9)
            .attr("dy", ".35em")
            .style("text-anchor", "end")
            .text(function(d) {
              return d;
            })
        });
      </script>
    </div>

  </main>

  <footer id="footer">
    <script>
      // Get the link element that references the header.html file.
      var footerTemplate = document.getElementById('std-footer');
      // Retrieve the loaded templates.
      var templates = footerTemplate.import
      // Get the template.
      var template = templates.getElementById('std-footer');
      if (template) {
        // Clone the templates contents
        var clone = document.importNode(template.content, true);
        // Add the template code to the page header
        document.getElementById('footer').appendChild(clone);
      } else {
        console.log('unable to access template.');
      }
    </script>
  </footer>


</body>

</html>
