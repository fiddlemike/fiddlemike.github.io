<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Michael Machado - Visualizations</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v0.3.min.js"></script>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="../css/custom.css">
  <link rel="stylesheet" href="css/barchart.css">

</head>

<body class="container">
  <header id="header">
    <nav class="navbar navbar-default" role="navigation">
      <div class="container-fluid">

        <div class="navbar-header">
          <a class="navbar-brand" href="https://d3js.org/" target="_blank">
                <span class="glyphicon glyphicon glyphicon-tree-deciduous"></span>
                D3 is fun
            </a>

          <ul class="nav navbar-nav">
            <li><a href="/">Home</a></li>
            <li><a href="/scene1">Scene 1</a></li>
            <li><a href="/essay">Essay</a></li>
          </ul>
        </div>

      </div>
    </nav>
  </header>

  <main>
    <div id="viz" class="barchart">
      <svg width="960" height="500"></svg>
      <svg width="960" height="500"></svg>
      <script src="https://d3js.org/d3.v4.min.js"></script>
      <script>
        var svg = d3.select("svg"),
          margin = {
            top: 20,
            right: 20,
            bottom: 30,
            left: 80
          },
          width = +svg.attr("width") - margin.left - margin.right,
          height = +svg.attr("height") - margin.top - margin.bottom;

        var tooltip = d3.select("body").append("div").attr("class", "toolTip");

        var x = d3.scaleLinear().range([0, width]);
        var y = d3.scaleBand().range([height, 0]);

        var g = svg.append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

          d3.csv("data/incidents_by_year_and_state.csv", function(d) {
            return {
              year: d.year,
              state: d.state,
              freq: +d.freq // convert "freq" column to number
            };
          }, function(error, csv_data) {
            if (error) throw error;

            // console.log(data);
            var data = d3.nest()
              .key(function(d) {
                return d.state;
              })
              .rollup(function(d) {
                return d3.sum(d, function(g) {
                  return g.freq;
                });
              }).entries(csv_data);

            /* Sort from highest to lowest*/
            data.sort(function(a, b) {
              return a.value - b.value;
            });

            console.log(data);
          x.domain([0, d3.max(data, function(d) {
            return d.value;
          })]);
          y.domain(data.map(function(d) {
            return d.state;
          })).padding(0.1);

          g.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x).ticks(5).tickFormat(function(d) {
              return parseInt(d / 1000);
            }).tickSizeInner([-height]));

          g.append("g")
            .attr("class", "y axis")
            .call(d3.axisLeft(y));

          g.selectAll(".bar")
            .data(data)
            .enter().append("rect")
            .attr("class", "bar")
            .attr("x", 0)
            .attr("height", y.bandwidth())
            .attr("y", function(d) {
              return y(d.state);
            })
            .attr("width", function(d) {
              return x(d.value);
            })
            .on("mousemove", function(d) {
              tooltip
                .style("left", d3.event.pageX - 50 + "px")
                .style("top", d3.event.pageY - 70 + "px")
                .style("display", "inline-block")
                .html((d.state) + "<br>" + "£" + (d.value));
            })
            .on("mouseout", function(d) {
              tooltip.style("display", "none");
            });
        });
      </script>
    </div>

  </main>

  <footer id="footer">
    <hr>
    <p class="text-center text-muted">© Copyright 2018 Michael Machado</p>
  </footer>


</body>

</html>
